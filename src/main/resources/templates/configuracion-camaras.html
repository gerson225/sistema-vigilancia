<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Gesti√≥n de C√°maras - Configuraci√≥n</title>
    <style>
        /* Tus estilos actuales del sidebar + nuevos estilos para gesti√≥n */
        .config-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .table-responsive {
            overflow-x: auto;
        }
        
        .badge-activa { background: #27ae60; }
        .badge-inactiva { background: #e74c3c; }
    </style>
    <script src="/js/session-manager.js"></script>
</head>
<body>
    <!-- Sidebar (igual que en personas.html) -->
    <div class="sidebar">
        
    </div>

    <!-- Contenido principal -->
    <div class="main-content">
        <h1>‚öôÔ∏è Gesti√≥n de C√°maras</h1>
        
        <!-- Formulario de registro -->
        <div class="config-section">
            <h2>‚ûï Registrar Nueva C√°mara</h2>
            <form id="formCamara">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="nombreCamara">Nombre de la c√°mara *</label>
                        <input type="text" id="nombreCamara" required>
                    </div>
                    <div class="form-group">
                        <label for="ubicacion">Ubicaci√≥n *</label>
                        <input type="text" id="ubicacion" required>
                    </div>
                    <div class="form-group">
                        <label for="direccionIp">Direcci√≥n IP *</label>
                        <input type="text" id="direccionIp" required placeholder="192.168.1.100">
                    </div>
                    <div class="form-group">
                        <label for="estado">Estado inicial</label>
                        <select id="estado">
                            <option value="ACTIVA">Activa</option>
                            <option value="INACTIVA">Inactiva</option>
                        </select>
                    </div>
                </div>
                <button type="button" class="btn btn-success" onclick="guardarCamara()">üíæ Guardar C√°mara</button>
            </form>
        </div>

        <!-- Lista de c√°maras -->
        <div class="config-section">
            <h2>üìã C√°maras Registradas</h2>
            <div class="table-responsive">
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nombre</th>
                            <th>Ubicaci√≥n</th>
                            <th>Direcci√≥n IP</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tablaCamaras">
                        <!-- Se llenar√° din√°micamente -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // JavaScript para la gesti√≥n de c√°maras
        document.addEventListener('DOMContentLoaded', function() {
            cargarCamaras();
        });

        async function cargarCamaras() {
            try {
                const response = await fetch('/api/camaras');
                if (response.ok) {
                    const camaras = await response.json();
                    actualizarTablaCamaras(camaras);
                }
            } catch (error) {
                console.error('Error cargando c√°maras:', error);
            }
        }

        function actualizarTablaCamaras(camaras) {
            const tbody = document.getElementById('tablaCamaras');
            tbody.innerHTML = '';

            camaras.forEach(camara => {
                const row = `
                    <tr>
                        <td>${camara.idCamara}</td>
                        <td>${camara.nombreCamara}</td>
                        <td>${camara.ubicacion}</td>
                        <td>${camara.direccionIp}</td>
                        <td>
                            <span class="badge badge-${camara.estado.toLowerCase()}">
                                ${camara.estado}
                            </span>
                        </td>
                        <td>
                            <button class="btn btn-warning" onclick="editarCamara(${camara.idCamara})">‚úèÔ∏è Editar</button>
                            <button class="btn btn-danger" onclick="eliminarCamara(${camara.idCamara})">üóëÔ∏è Eliminar</button>
                            <button class="btn btn-info" onclick="toggleEstado(${camara.idCamara})">
                                ${camara.estado === 'ACTIVA' ? '‚è∏Ô∏è Pausar' : '‚ñ∂Ô∏è Activar'}
                            </button>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        async function guardarCamara() {
            const camaraData = {
                nombreCamara: document.getElementById('nombreCamara').value,
                ubicacion: document.getElementById('ubicacion').value,
                direccionIp: document.getElementById('direccionIp').value,
                estado: document.getElementById('estado').value
            };

            try {
                const response = await fetch('/api/camaras', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(camaraData)
                });

                if (response.ok) {
                    alert('‚úÖ C√°mara registrada correctamente');
                    document.getElementById('formCamara').reset();
                    cargarCamaras();
                } else {
                    alert('‚ùå Error al registrar la c√°mara');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('‚ùå Error al registrar la c√°mara');
            }
        }

        async function eliminarCamara(id) {
            if (confirm('¬øEst√°s seguro de eliminar esta c√°mara?')) {
                try {
                    const response = await fetch(`/api/camaras/${id}`, {
                        method: 'DELETE'
                    });

                    if (response.ok) {
                        alert('‚úÖ C√°mara eliminada correctamente');
                        cargarCamaras();
                    } else {
                        alert('‚ùå Error al eliminar la c√°mara');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('‚ùå Error al eliminar la c√°mara');
                }
            }
        }

        async function toggleEstado(id) {
            try {
                const response = await fetch(`/api/camaras/${id}/toggle`, {
                    method: 'POST'
                });

                if (response.ok) {
                    alert('‚úÖ Estado de c√°mara actualizado');
                    cargarCamaras();
                } else {
                    alert('‚ùå Error al cambiar estado');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('‚ùå Error al cambiar estado');
            }
        }

        // Funci√≥n editarCamara (similar a la de personas)
        async function editarCamara(id) {
            // Implementar similar al m√≥dulo de personas
            alert(`‚úèÔ∏è Editar c√°mara ${id} - Por implementar`);
        }
    </script>
</body>
</html>