<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Gesti√≥n de C√°maras - Configuraci√≥n</title>
    <link rel="stylesheet" href="/css/layout.css">
    <style>
        /* üî• ESTILOS ESPEC√çFICOS SOLO PARA ESTA P√ÅGINA */
        .btn {
    padding: 8px 15px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 12px;
    margin: 2px;
    transition: all 0.3s;
}

.btn-warning {
    background: #f39c12;
    color: white;
}

.btn-warning:hover {
    background: #e67e22;
}

.btn-danger {
    background: #e74c3c;
    color: white;
}

.btn-danger:hover {
    background: #c0392b;
}

.btn-info {
    background: #3498db;
    color: white;
}

.btn-info:hover {
    background: #2980b9;
}

.btn-success {
    background: #27ae60;
    color: white;
}

.btn-success:hover {
    background: #219653;
}

/* Badges para estados */
.badge-activa {
    background: #27ae60;
    color: white;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: bold;
}

.badge-inactiva {
    background: #e74c3c;
    color: white;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: bold;
}

/* Formulario */
.form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 20px;
}

.form-group {
    margin-bottom: 15px;
}

.form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
    color: #2c3e50;
}

.form-group input,
.form-group select {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 5px;
    font-size: 14px;
}

.form-group input:focus,
.form-group select:focus {
    outline: none;
    border-color: #3498db;
    box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
}
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .help-text {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 5px;
        }
        
        .camera-status {
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
        }
        
        .status-activa { background: #27ae60; }
        .status-inactiva { background: #e74c3c; }
    </style>
    <script src="/js/session-manager.js"></script>
</head>
<body>
    <!-- Sidebar (igual que en personas.html) -->
    <div class="sidebar">
        
    </div>

    <!-- Contenido principal -->
    <div class="main-content">
        <h1>‚öôÔ∏è Gesti√≥n de C√°maras</h1>
        
        <!-- Formulario de registro -->
        <div class="config-section">
            <h2>‚ûï Registrar Nueva C√°mara</h2>
            <form id="formCamara">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="nombreCamara">Nombre de la c√°mara *</label>
                        <input type="text" id="nombreCamara" required>
                    </div>
                    <div class="form-group">
                        <label for="ubicacion">Ubicaci√≥n *</label>
                        <input type="text" id="ubicacion" required>
                    </div>
                    <div class="form-group">
                        <label for="direccionIp">Direcci√≥n IP *</label>
                        <input type="text" id="direccionIp" required placeholder="192.168.1.100">
                    </div>
                    <div class="form-group">
                        <label for="estado">Estado inicial</label>
                        <select id="estado">
                            <option value="ACTIVA">Activa</option>
                            <option value="INACTIVA">Inactiva</option>
                        </select>
                    </div>
                </div>
                <button type="button" class="btn btn-success" onclick="guardarCamara()">üíæ Guardar C√°mara</button>
            </form>
        </div>

        <!-- Lista de c√°maras -->
        <div class="config-section">
            <h2>üìã C√°maras Registradas</h2>
            <div class="table-responsive">
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nombre</th>
                            <th>Ubicaci√≥n</th>
                            <th>Direcci√≥n IP</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tablaCamaras">
                        <!-- Se llenar√° din√°micamente -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // JavaScript para la gesti√≥n de c√°maras
        document.addEventListener('DOMContentLoaded', function() {
            cargarCamaras();
        });

        async function cargarCamaras() {
            try {
                const response = await fetch('/api/camaras');
                if (response.ok) {
                    const camaras = await response.json();
                    actualizarTablaCamaras(camaras);
                }
            } catch (error) {
                console.error('Error cargando c√°maras:', error);
            }
        }

        function actualizarTablaCamaras(camaras) {
            const tbody = document.getElementById('tablaCamaras');
            tbody.innerHTML = '';

            camaras.forEach(camara => {
                const row = `
                    <tr>
                        <td>${camara.idCamara}</td>
                        <td>${camara.nombreCamara}</td>
                        <td>${camara.ubicacion}</td>
                        <td>${camara.direccionIp}</td>
                        <td>
                            <span class="badge badge-${camara.estado.toLowerCase()}">
                                ${camara.estado}
                            </span>
                        </td>
                        <td>
                            <button class="btn btn-warning" onclick="editarCamara(${camara.idCamara})">‚úèÔ∏è Editar</button>
                            <button class="btn btn-danger" onclick="eliminarCamara(${camara.idCamara})">üóëÔ∏è Eliminar</button>
                            <button class="btn btn-info" onclick="toggleEstado(${camara.idCamara})">
                                ${camara.estado === 'ACTIVA' ? '‚è∏Ô∏è Pausar' : '‚ñ∂Ô∏è Activar'}
                            </button>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        async function guardarCamara() {
            const camaraData = {
                nombreCamara: document.getElementById('nombreCamara').value,
                ubicacion: document.getElementById('ubicacion').value,
                direccionIp: document.getElementById('direccionIp').value,
                estado: document.getElementById('estado').value
            };

            try {
                const response = await fetch('/api/camaras', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(camaraData)
                });

                if (response.ok) {
                    alert('‚úÖ C√°mara registrada correctamente');
                    document.getElementById('formCamara').reset();
                    cargarCamaras();
                } else {
                    alert('‚ùå Error al registrar la c√°mara');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('‚ùå Error al registrar la c√°mara');
            }
        }

        async function eliminarCamara(id) {
            if (confirm('¬øEst√°s seguro de eliminar esta c√°mara?')) {
                try {
                    const response = await fetch(`/api/camaras/${id}`, {
                        method: 'DELETE'
                    });

                    if (response.ok) {
                        alert('‚úÖ C√°mara eliminada correctamente');
                        cargarCamaras();
                    } else {
                        alert('‚ùå Error al eliminar la c√°mara');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('‚ùå Error al eliminar la c√°mara');
                }
            }
        }

        async function toggleEstado(id) {
            try {
                const response = await fetch(`/api/camaras/${id}/toggle`, {
                    method: 'POST'
                });

                if (response.ok) {
                    alert('‚úÖ Estado de c√°mara actualizado');
                    cargarCamaras();
                } else {
                    alert('‚ùå Error al cambiar estado');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('‚ùå Error al cambiar estado');
            }
        }

        // Funci√≥n editarCamara (similar a la de personas)
        async function editarCamara(id) {
            // Implementar similar al m√≥dulo de personas
            alert(`‚úèÔ∏è Editar c√°mara ${id} - Por implementar`);
        }
        let camaraEditando = null;

// Funci√≥n para abrir modal de edici√≥n
async function editarCamara(idCamara) {
    try {
        console.log(`‚úèÔ∏è Editando c√°mara ID: ${idCamara}`);
        
        // Obtener datos de la c√°mara
        const response = await fetch(`/api/camaras/${idCamara}`);
        
        if (!response.ok) {
            throw new Error('C√°mara no encontrada');
        }
        
        const camara = await response.json();
        console.log('üìä Datos de c√°mara:', camara);
        
        // Guardar ID de la c√°mara que estamos editando
        camaraEditando = camara.idCamara;
        
        // Llenar formulario con datos actuales
        document.getElementById('nombreCamara').value = camara.nombreCamara || '';
        document.getElementById('ubicacion').value = camara.ubicacion || '';
        document.getElementById('direccionIp').value = camara.direccionIp || '';
        document.getElementById('estado').value = camara.estado || 'ACTIVA';
        
        // Cambiar t√≠tulo del modal
        document.querySelector('.config-section h2').textContent = '‚úèÔ∏è Editar C√°mara';
        
        // Cambiar texto del bot√≥n
        const btnGuardar = document.querySelector('.btn-success');
        btnGuardar.textContent = 'üíæ Actualizar C√°mara';
        btnGuardar.onclick = actualizarCamara; // Cambiar funci√≥n
        
        // Desplazar a la secci√≥n del formulario
        document.querySelector('.config-section').scrollIntoView({ behavior: 'smooth' });
        
    } catch (error) {
        console.error('Error cargando c√°mara:', error);
        alert('‚ùå Error al cargar los datos de la c√°mara: ' + error.message);
    }
}

// Funci√≥n para actualizar c√°mara
async function actualizarCamara() {
    if (!camaraEditando) {
        alert('‚ùå No hay c√°mara seleccionada para editar');
        return;
    }
    
    const camaraData = {
        nombreCamara: document.getElementById('nombreCamara').value,
        ubicacion: document.getElementById('ubicacion').value,
        direccionIp: document.getElementById('direccionIp').value,
        estado: document.getElementById('estado').value
    };

    // Validaciones b√°sicas
    if (!camaraData.nombreCamara || !camaraData.ubicacion || !camaraData.direccionIp) {
        alert('‚ùå Por favor complete todos los campos obligatorios');
        return;
    }

    try {
        const response = await fetch(`/api/camaras/${camaraEditando}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(camaraData)
        });

        if (response.ok) {
            alert('‚úÖ C√°mara actualizada correctamente');
            
            // Restaurar formulario a modo "nueva c√°mara"
            resetearFormulario();
            
            // Recargar lista de c√°maras
            cargarCamaras();
            
        } else {
            const error = await response.text();
            alert('‚ùå Error al actualizar la c√°mara: ' + error);
        }
    } catch (error) {
        console.error('Error:', error);
        alert('‚ùå Error al actualizar la c√°mara');
    }
}

// Funci√≥n para resetear formulario a modo "nueva c√°mara"
function resetearFormulario() {
    camaraEditando = null;
    document.getElementById('nombreCamara').value = '';
    document.getElementById('ubicacion').value = '';
    document.getElementById('direccionIp').value = '';
    document.getElementById('estado').value = 'ACTIVA';
    
    // Restaurar t√≠tulo y bot√≥n
    document.querySelector('.config-section h2').textContent = '‚ûï Registrar Nueva C√°mara';
    
    const btnGuardar = document.querySelector('.btn-success');
    btnGuardar.textContent = 'üíæ Guardar C√°mara';
    btnGuardar.onclick = guardarCamara; // Volver a funci√≥n original
}

// Modificar la funci√≥n guardarCamara existente para que llame a resetearFormulario
async function guardarCamara() {
    const camaraData = {
        nombreCamara: document.getElementById('nombreCamara').value,
        ubicacion: document.getElementById('ubicacion').value,
        direccionIp: document.getElementById('direccionIp').value,
        estado: document.getElementById('estado').value
    };

    // Validaciones b√°sicas
    if (!camaraData.nombreCamara || !camaraData.ubicacion || !camaraData.direccionIp) {
        alert('‚ùå Por favor complete todos los campos obligatorios');
        return;
    }

    try {
        const response = await fetch('/api/camaras', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(camaraData)
        });

        if (response.ok) {
            alert('‚úÖ C√°mara registrada correctamente');
            resetearFormulario();
            cargarCamaras();
        } else {
            const error = await response.text();
            alert('‚ùå Error al registrar la c√°mara: ' + error);
        }
    } catch (error) {
        console.error('Error:', error);
        alert('‚ùå Error al registrar la c√°mara');
    }
}

// Modificar la funci√≥n actualizarTablaCamaras para incluir bot√≥n de editar
function actualizarTablaCamaras(camaras) {
    const tbody = document.getElementById('tablaCamaras');
    tbody.innerHTML = '';

    camaras.forEach(camara => {
        const row = `
            <tr>
                <td>${camara.idCamara}</td>
                <td>${camara.nombreCamara}</td>
                <td>${camara.ubicacion}</td>
                <td>${camara.direccionIp}</td>
                <td>
                    <span class="badge badge-${camara.estado.toLowerCase()}">
                        ${camara.estado}
                    </span>
                </td>
                <td>
                    <button class="btn btn-warning" onclick="editarCamara(${camara.idCamara})">‚úèÔ∏è Editar</button>
                    <button class="btn btn-danger" onclick="eliminarCamara(${camara.idCamara})">üóëÔ∏è Eliminar</button>
                    <button class="btn btn-info" onclick="toggleEstado(${camara.idCamara})">
                        ${camara.estado === 'ACTIVA' ? '‚è∏Ô∏è Pausar' : '‚ñ∂Ô∏è Activar'}
                    </button>
                </td>
            </tr>
        `;
        tbody.innerHTML += row;
    });
}

// Agregar bot√≥n "Cancelar edici√≥n" al formulario
function agregarBotonCancelar() {
    const form = document.getElementById('formCamara');
    const btnGuardar = document.querySelector('.btn-success');
    
    // Crear bot√≥n cancelar si no existe
    if (!document.querySelector('.btn-cancelar')) {
        const btnCancelar = document.createElement('button');
        btnCancelar.type = 'button';
        btnCancelar.className = 'btn btn-danger btn-cancelar';
        btnCancelar.textContent = '‚ùå Cancelar';
        btnCancelar.style.marginLeft = '10px';
        btnCancelar.onclick = resetearFormulario;
        
        // Insertar despu√©s del bot√≥n guardar
        btnGuardar.parentNode.insertBefore(btnCancelar, btnGuardar.nextSibling);
    }
}

// Inicializar cuando la p√°gina cargue
document.addEventListener('DOMContentLoaded', function() {
    agregarBotonCancelar();
    cargarCamaras();
});
    </script>
</body>
</html>