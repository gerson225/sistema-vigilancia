<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Panel de Alertas</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #f4f6f8;
      display: flex; /* coloca sidebar y contenido en fila */
      height: 100vh;
    }
    /* Sidebar */
    .sidebar {
      width: 220px;
      background-color: #2c3e50;
      color: white;
      display: flex;
      flex-direction: column;
      padding: 20px 0;
    }
    .sidebar h2 {
      text-align: center;
      margin-bottom: 30px;
    }
    .sidebar a {
      color: white;
      text-decoration: none;
      padding: 12px 20px;
      display: block;
      transition: background 0.3s;
    }
    .sidebar a:hover {
      background-color: #34495e;
    }
    /* Contenido principal */
    .main-content {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }
    h1 {
      text-align: center;
      color: #2c3e50;
    }
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }
    .card {
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      background: white;
      text-align: center;
    }
    .card h5 {
      margin-bottom: 10px;
      color: #2c3e50;
    }
    .card p {
      font-size: 1.5rem;
      font-weight: bold;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: white;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    table th, table td {
      padding: 12px;
      border: 1px solid #ddd;
      text-align: center;
    }
    table th {
      background-color: #2c3e50;
      color: white;
    }
    .badge {
      padding: 5px 10px;
      border-radius: 5px;
      color: white;
    }
    .bg-danger { background-color: #e74c3c; }
    .bg-warning { background-color: #f39c12; }
    .bg-success { background-color: #27ae60; }
    canvas {
      max-width: 100%;
      height: 300px;
      margin: 20px auto;
      display: block;
    }
  </style>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
      <h2>SIVI</h2>
      <a href="/dashboard">Dashboard</a>
      <a href="/alertas">Alertas</a>
      <a href="/camaras">Cámaras</a>
      <a href="/personas">Personas</a>
      <a href="/detecciones">Detecciones</a>
      <a href="/configuracion">Configuración</a>
    </div>

    <!-- Contenido de Alerta -->
    <div class="main-content">
      <h1>Panel de Alertas</h1>

      <!-- Cards resumen -->
      <div class="dashboard-grid">
        <div class="card">
          <h5>Total</h5>
          <p th:text="${totalAlertas}">0</p>
        </div>
        <div class="card">
          <h5 class="text-danger">Críticas</h5>
          <p class="text-danger" th:text="${alertasCriticas}">0</p>
        </div>
        <div class="card">
          <h5 class="text-warning">Pendientes</h5>
          <p class="text-warning" th:text="${alertasPendientes}">0</p>
        </div>
        <div class="card">
          <h5 class="text-success">Resueltas</h5>
          <p class="text-success" th:text="${alertasResueltas}">0</p>
        </div>
      </div>

      <!-- Tabla de alertas -->
      <table>
        <thead>
          <tr>
            <th>Hora</th>
            <th>Tipo</th>
            <th>Estado</th>
            <th>Operador</th>
          </tr>
        </thead>
        <tbody>
          <tr th:each="alerta : ${alertas}">
            <td th:text="${alerta.hora}"></td>
            <td th:text="${alerta.tipo}"></td>
            <td>
              <span th:text="${alerta.estado}"
                    th:classappend="${alerta.estado == 'CRITICA'} ? 'badge bg-danger' :
                                    ${alerta.estado == 'PENDIENTE'} ? 'badge bg-warning' :
                                    'badge bg-success'">
              </span>
            </td>
            <td th:text="${alerta.operador}"></td>
          </tr>
        </tbody>
      </table>

      <!-- Gráfico de tendencias -->
      <canvas id="alertasChart"></canvas>
    </div>

    <!-- Script Chart.js -->
    <script th:inline="javascript">
      /*<![CDATA[*/
      const ctx = document.getElementById('alertasChart');
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: /*[[${horas}]]*/ ["08:00","10:00","12:00","14:00","16:00"],
          datasets: [{
            label: 'Alertas',
            data: /*[[${valores}]]*/ [2,5,3,7,4],
            borderColor: 'red',
            backgroundColor: 'rgba(255,0,0,0.2)',
            fill: true,
            tension: 0.3
          }]
        }
      });
      /*]]>*/
    </script>
</body>
</html>
